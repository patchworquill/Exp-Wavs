<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Experimental Waves</title>
    <<style media="screen">
      body {margin: 0;}
      canvas {width: 100%; height:100%;}
    </style>
    <script id="vertexShader" type="x-shader/x-vertex">
        void main() {
            gl_Position = vec4( position, 1.0 );
        }
    </script>
  </head>

  <body>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/SimplexNoise.js"></script>
    <script src='js/threex.terrain.js'></script>
    <script id="vertexShader" type="x-shader/x-vertex">
        void main() {
            gl_Position = vec4( position, 1.0 );
        }
    </script>
    <div id="container"></div>
    <script src="js/three.min.js"></script>
    <script id="fragmentShader" type="x-shader/x-fragment">
        vec3 pal( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d )
        {
            return a + b*cos( 6.28318*(c*t+d) );
        }

        vec3 spectral_palette(float x) {
            /* case 0: return pal( x, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,0.7,0.4),vec3(0.0,0.15,0.20));
            // case 1: return pal( x, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,1.0),vec3(0.0,0.33,0.67));
            // case 2: return pal( x, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,0.5),vec3(0.8,0.90,0.30));
            // case 3: return pal( x, vec3(0.5,0.5,0.5),vec3(0.5,0.5,0.5),vec3(1.0,1.0,1.0),vec3(0.0,0.10,0.20));
            */
            return pal( x, vec3(0.2,0.1,0.5),vec3(0.5,0.5,0.5),vec3(1.0,0.7,0.7),vec3(0.0,0.22,0.91));
        }

        uniform vec2 u_resolution;
        uniform float u_time;

        void main()
        {
          // vec2 st = gl_FragCoord.xy/u_resolution.xy;
          //gl_FragColor=vec4(st.x,st.y,0.0,1.0);
          vec2 p = (2.0*gl_FragCoord.xy-u_resolution.xy)/max(u_resolution.x,u_resolution.y);

          for(int i=1;i<50;i++)
          {
            p=p+vec2(
              0.6/float(i)*sin(float(i)*p.y+ u_time +0.3*float(i))+1.0,
              0.6/float(i)*sin(float(i)*p.x+ u_time +0.3*float(i+10))-1.4
            );
          }
          vec3 col=spectral_palette(p.x-48.5);
          gl_FragColor=vec4(pow(col,vec3(1.0/2.2)),1.0);
        }
    </script>
    <script type="text/javascript">
      var container;
      var uniforms;
      var scene = new THREE.Scene( );
      scene.background = ({color: 0xFFFFFF});
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 ); // near clipping plane, far clipping plane

      var raycaster = new THREE.Raycaster();
			var mouse = new THREE.Vector2();

      var renderer = new THREE.WebGLRenderer( {antialias: true} );
      renderer.setPixelRatio( window.devicePixelRatio );
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      window.addEventListener( 'resize', function( )
      {
        var width = window.innerHeight;
        var height = window.innerHeight;
        renderer.setSize( width, height );

        camera.aspect = width / height;
        camera.updateProjectionMatrix( );
      } );

      controls = new THREE.OrbitControls( camera, renderer.domElement );
      //controls.autoRotate = true;
      //controls.autoRotateSpeed = 2.0; // default is 2
      //controls.minDistance = 1;
			//controls.maxDistance = 10;
			// controls.maxPolarAngle = Math.PI / 2;
      // controls.enableDamping = true;
      // controls.dampingFactor = 1.0;

      // var ray = new THREE.Raycaster(  );
      // var mouse = new THREE.Vector2( );

      function onMouseMove( event ) {

      	// calculate mouse position in normalized device coordinates
      	// (-1 to +1) for both components
      	mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
      	mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

      }

      var geometry = new THREE.PlaneBufferGeometry( 2, 2 );

      uniforms = {
          u_time: { type: "f", value: 1.0 },
          u_resolution: { type: "v2", value: new THREE.Vector2() },
          u_mouse: { type: "v2", value: new THREE.Vector2() }
      };

      var material = new THREE.ShaderMaterial( {
          uniforms: uniforms,
          vertexShader: document.getElementById( 'vertexShader' ).textContent,
          fragmentShader: document.getElementById( 'fragmentShader' ).textContent
      } );

      var mesh = new THREE.Mesh( geometry, material );
      scene.add( mesh );

      /* Play around with camera positioning */
    	camera.position.z = 15;
      camera.position.y = 2;

      /* Fog provides depth to the landscape*/
      // scene.fog = new THREE.Fog(0x000, 0, 45);
    	// (function(){
    	// 	var light	= new THREE.AmbientLight( 0x202020 )
    	// 	scene.add( light )
    	// 	var light	= new THREE.DirectionalLight('white', 5)
    	// 	light.position.set(0.5, 0.0, 2)
    	// 	scene.add( light )
    	// 	var light	= new THREE.DirectionalLight('white', 0.75*2)
    	// 	light.position.set(-0.5, -0.5, -2)
    	// 	scene.add( light )
    	// })

      // game logic
      var update = function()
      {
          var time = Date.now( ) * 0.0005;
      };

      // draw Scene
      var render = function( )
      {
        renderer.render( scene, camera );
      };

      // run game loop (update, render, repeat)
      var GameLoop = function( )
      {
        requestAnimationFrame( GameLoop );

        update( );
        render( );
      };

      window.addEventListener( 'mousemove', onMouseMove, false );
      GameLoop( );
    </script>
  </body>
</html>
